# 数学問題生成AIシステム 開発ロードマップ

## フェーズ1: 開発環境セットアップと基本構造の構築

### 1.1 プロジェクト初期化
- [x] プロジェクトディレクトリ構造の作成
- [x] Gitリポジトリの初期化
- [x] .gitignoreファイルの作成
- [x] 環境変数テンプレート（.env.example）の作成

**デバッグポイント1.1**: プロジェクト初期化の確認
- [x] ディレクトリ構造の確認
- [x] Gitリポジトリの初期化確認
- [x] .gitignoreの設定確認
- [x] 環境変数テンプレートの内容確認

### 1.2 開発環境のセットアップ
- [x] Node.js環境のセットアップ（v20.10.0以上）
- [x] Python環境のセットアップ（3.11.0以上）
- [x] TeX Live環境のセットアップ（2023以上）
- [x] 必要なパッケージマネージャーのバージョン確認（npm 10.2.0以上、pip 23.3以上）

**デバッグポイント1.2**: 開発環境の確認
- [x] Node.jsバージョン確認（v22.15.0）
- [x] Pythonバージョン確認（v3.13.3）
- [x] TeX環境の動作確認（TeX Live 2025）
- [x] パッケージマネージャーのバージョン確認（npm 10.9.2、pip 25.0.1）

### 1.3 依存関係のインストール
- [x] ルートディレクトリのpackage.json作成
- [x] フロントエンド依存関係のインストール
  - React 18.2.0以上（v19.1.0）
  - Vite 5.0.0以上（v6.3.3）
  - TypeScript 5.3.0以上（v5.7.3）
  - Chakra UI 2.8.0以上（v3.16.1）
  - PDF.js 3.11.174以上（v5.1.91）
- [x] バックエンド依存関係のインストール
  - Express 4.18.2以上（v4.18.2）
  - LangChain 0.1.0以上（v0.3.56）
  - LangGraph 0.0.30以上（v0.3.34）
  - LangSmith 0.0.69以上（v0.3.37）
- [x] Python依存関係のインストール
  - OpenAI API SDK 4.20.0以上（v1.76.0）
  - PyLaTeX 1.4.2以上（v1.4.2）
  - pytest 7.4.0以上（v8.3.5）
- [x] 開発ツールのセットアップ
  - ESLint 8.56.0以上（v8.57.1）
  - Prettier 3.1.0以上（v3.1.0）
  - Jest 29.7.0以上（v29.7.0）

**デバッグポイント1.3**: 依存関係の確認
- [x] package.jsonの内容確認
- [x] フロントエンド依存関係のバージョン確認
- [x] バックエンド依存関係のバージョン確認
- [x] Python依存関係のバージョン確認
- [x] 開発ツールの動作確認

### 1.4 基本設定ファイルの作成
- [x] TypeScript設定（tsconfig.json）
- [x] ESLint設定
- [x] Prettier設定
- [x] Vite設定
- [x] Jest設定
- [x] pytest設定

**デバッグポイント1.4**: 設定ファイルの確認
- [x] TypeScript設定の動作確認
- [x] ESLintの動作確認
- [x] Prettierの動作確認
- [x] Viteの動作確認
- [x] Jestの動作確認
- [x] pytestの動作確認

## フェーズ2: バックエンド基盤の構築

### 2.1 Expressサーバーの構築
- [x] 基本的なExpressサーバーの実装
- [x] ルーティング構造の設定
- [x] エラーハンドリングの実装
- [x] ミドルウェアの設定

**デバッグポイント2.1**: Expressサーバーの確認
- [x] サーバー起動確認
- [x] ルーティングの動作確認
- [x] エラーハンドリングの動作確認
- [x] ミドルウェアの動作確認

### 2.2 LangGraphエージェント基盤の構築
- [x] 状態管理クラスの実装
- [x] エージェントグラフの基本構造の実装
- [x] 各エージェントの基本クラスの実装
  - スロットフィリングエージェント
  - 問題生成エージェント
  - 検証エージェント
  - 問題修正エージェント
  - TeX整形エージェント
  - PDF生成ハンドラ

**デバッグポイント2.2**: LangGraph基盤の確認
- [x] 状態管理クラスの動作確認
- [x] エージェントグラフの初期化確認
- [x] 各エージェントの基本機能確認
- [x] エージェント間の連携確認

### 2.3 OpenAI API連携の実装
- [x] APIクライアントの設定
- [x] 環境変数によるAPIキー管理の実装
- [x] 基本的なAPI呼び出しの実装

**デバッグポイント2.3**: OpenAI API連携の確認
- [x] APIクライアントの初期化確認
- [x] 環境変数の読み込み確認
- [x] API呼び出しの動作確認
- [x] エラーハンドリングの確認

### 2.4 TeX/PDF生成基盤の実装
- [x] TeXテンプレートの作成
- [x] TikZ図形生成ヘルパーの実装
- [x] PDF生成パイプラインの実装

**デバッグポイント2.4**: TeX/PDF生成基盤の確認
- [x] TeXテンプレートの動作確認
- [x] TikZ図形生成の動作確認
- [x] PDF生成パイプラインの動作確認
- [x] 生成されたPDFの品質確認

## フェーズ3: フロントエンド基盤の構築

### 3.1 基本UI構造の実装
- [x] レイアウトコンポーネントの作成
- [x] チャットインターフェースの実装
- [x] PDFプレビュー領域の実装
- [x] メッセージ入力エリアの実装

**デバッグポイント3.1**: UI構造の確認
- [x] レイアウトの表示確認
- [x] チャットインターフェースの動作確認
- [x] PDFプレビュー領域の表示確認
- [x] メッセージ入力の動作確認

### 3.2 状態管理の実装
- [x] コンテキストの作成
- [x] 状態管理ロジックの実装
- [x] APIとの通信ロジックの実装

**デバッグポイント3.2**: 状態管理の確認
- [x] コンテキストの初期化確認
- [x] 状態更新の動作確認
- [x] API通信の動作確認
- [x] エラーハンドリングの確認

### 3.3 PDFビューアーの実装
- [x] PDF.jsの統合
- [x] プレビューコンポーネントの実装
- [x] 保存機能の実装

**デバッグポイント3.3**: PDFビューアーの確認
- [x] PDF.jsの初期化確認
- [x] プレビュー表示の動作確認
- [x] 保存機能の動作確認
- [ ] 大きなPDFファイルの処理確認

## フェーズ4: エージェント機能の実装

### 4.1 スロットフィリングエージェントの実装
- [x] JSON構造の定義
- [x] 対話ロジックの実装
- [x] 入力検証の実装

**デバッグポイント4.1**: スロットフィリングの確認
- [x] JSON構造の妥当性確認
  - [x] 入出力スキーマが要件通りに定義されているか
  - [x] 必須項目（subject/難易度、difficulty/分野）が正しく指定されているか
  - [x] オプション項目の型が適切に定義されているか
  - [x] 実際のJSONデータがスキーマに準拠しているか検証
- [x] 対話ロジックの動作確認
  - [x] ユーザー入力を適切に解析して問題仕様に反映できるか
  - [x] 未入力の必須項目がある場合に適切な質問を生成できるか
  - [x] 複数ターンの対話が正しく履歴に記録されるか
  - [x] すべての必須項目が埋まった際に完了状態に遷移するか
- [x] 入力検証の動作確認
  - [x] 必須項目の欠落を正しく検出できるか
  - [x] 入力値の制約（問題数が1〜10の範囲内など）を検証できるか
  - [x] 不適切な入力値に対して適切なフィードバックを提供できるか
- [x] エラー処理の確認
  - [x] API呼び出しエラーに対して適切に対応できるか
  - [x] 無効な入力フォーマットに対して適切なエラーメッセージを返せるか
  - [x] エラー発生時にも状態を維持し、会話を継続できるか

### 4.2 問題生成エージェントの実装
- [x] 問題生成ロジックの実装
- [x] 解答生成ロジックの実装
- [x] 図形中間表現生成の実装

**デバッグポイント4.2**: 問題生成の確認
- [x] 問題生成の品質確認
  - [x] 異なる難易度（小学生、中学生、高校生）で適切な問題が生成されるか
  - [x] 各数学分野（数と式、関数、図形、確率・統計など）に合った問題が生成されるか
  - [x] 問題文が明確で理解しやすいか
  - [x] 日本語の文法や表現が自然か
  - [x] 教育効果を考慮した問題設計になっているか
- [x] 解答生成の正確性確認
  - [x] 計算結果が数学的に正確か
  - [x] 解法のステップが論理的に説明されているか
  - [x] 数学的な考え方や定理の適用が明示されているか
  - [x] 誤りや不適切な解法がないか
  - [x] 難易度に適した解答の詳細さか
- [x] 難易度の適合性確認
  - [x] 小学生向け問題が適切な難易度か（基本的な演算、簡単な図形）
  - [x] 中学生向け問題が適切な難易度か（方程式、関数、平面図形）
  - [x] 高校生向け問題が適切な難易度か（二次関数、三角関数、確率・統計）
  - [x] 指定された難易度と実際の問題の難しさが一致しているか
- [x] 図形中間表現の妥当性確認
  - [x] 関数グラフが必要な問題で適切な図形中間表現が生成されるか
  - [x] 幾何図形が必要な問題で適切な図形中間表現が生成されるか
  - [x] 座標やパラメータが数学的に正確か
  - [x] 図形が問題内容と整合しているか
  - [x] 不要な場合は視覚化フィールドが省略されているか

### 4.3 検証エージェントの実装
- [x] 解答検証の実装
  - [x] 解答の数学的正確性検証ロジックの実装
  - [x] 解法ステップの完全性検証ロジックの実装
  - [x] 検証結果のJSON形式出力機能の実装

**デバッグポイント4.3**: 検証機能の確認
- [x] 解答検証の動作確認
  - [x] 計算結果の正確性検証が適切に機能するか
  - [x] 解法手順の完全性検証が適切に機能するか
  - [x] 説明の十分性と教育的価値の評価が適切に機能するか
- [x] 検証結果の出力確認
  - [x] 検証結果がJSON形式で適切に出力されるか
  - [x] 問題点の詳細テキストが具体的で有用か
  - [x] スコア（0〜100）が適切に算出されるか
- [x] エラー処理の確認
  - [x] API呼び出しエラーに対して適切に対応できるか
  - [x] 不適切な入力に対して適切なエラーメッセージを返せるか

### 4.4 問題修正エージェントの実装
- [x] 修正ロジックの実装
  - [x] 解答検証結果に基づく問題修正ロジックの実装
  - [x] 解答の修正提案生成機能の実装
- [x] フィードバックループの実装
  - [x] 修正後の問題を再検証するフローの実装
  - [x] 検証-修正の反復回数管理機能の実装

**デバッグポイント4.4**: 問題修正の確認
- [x] 修正ロジックの動作確認
  - [x] 検証結果に基づいて適切な修正が提案されるか
  - [x] 解答の誤りが正確に修正されるか
- [x] フィードバックループの動作確認
  - [x] 修正された問題が再検証されるか
  - [x] 検証-修正のループが適切に終了するか
- [x] 修正後の品質確認
  - [x] 修正後の解答が数学的に正確か
  - [x] 修正回数が適切に制限されているか

### 4.5 TeX整形エージェントの実装
- [x] TeX変換ロジックの実装
- [x] 図形コード生成の実装

**デバッグポイント4.5**: TeX整形の確認
- [x] TeX変換の正確性確認
  - [x] 基本的な数式表現（分数、平方根、指数など）が正しくTeX記法に変換されるか
  - [x] インライン数式とディスプレイ数式が適切に区別されるか
  - [x] 特殊文字（$, %, &, #など）が適切にエスケープされるか
  - [x] 日本語と数式が混在する場合の処理が適切か
- [x] 図形コード生成の動作確認
  - [x] 関数グラフが図形中間表現から正確にTikZコードに変換されるか
  - [x] 幾何図形が図形中間表現から正確にTikZコードに変換されるか
  - [x] 座標系と軸のスケールやグリッドが適切に設定されるか
  - [x] 図形のラベルや注釈が正しく配置されるか
- [x] 生成されたTeXの妥当性確認
  - [x] 生成されたTeXコードがエラーなくコンパイルできるか
  - [x] PDF出力の視覚的品質が十分か（フォント、レイアウト、余白など）
  - [x] 問題文、解答、解説の構造が適切に反映されているか
  - [x] TeXテンプレートが正しく適用されているか
- [x] 複雑な数式の処理確認
  - [x] 多段の分数や入れ子の平方根などの複雑な数式が正しく処理されるか
  - [x] 行列や連立方程式の表現が適切か
  - [x] 積分、微分、極限などの高度な数式表現が正しく変換されるか
  - [x] 数式内の添え字や上付き文字が正しく処理されるか

## フェーズ5: 統合とテスト

### 5.1 エンドツーエンドテストの実装
- [x] テストケースの作成
- [x] 自動テストの実装
- [x] エッジケースのテスト

**デバッグポイント5.1**: テスト実装の確認
- [x] テストケースの網羅性確認
- [x] 自動テストの実行確認
- [x] エッジケースの処理確認
- [x] テスト結果の分析

### 5.2 ドキュメント作成
- [x] API仕様書の作成
- [x] セットアップガイドの作成
- [x] ユーザーマニュアルの作成

**デバッグポイント5.2**: ドキュメントの確認
- [ ] API仕様書の正確性確認
- [x] セットアップガイドの動作確認
- [ ] ユーザーマニュアルの分かりやすさ確認
- [ ] ドキュメントの一貫性確認

## フェーズ6: デプロイ準備

### 6.1 セキュリティチェック
- [ ] セキュリティ脆弱性のチェック
- [ ] APIキーの管理確認
- [ ] エラーログの確認

**デバッグポイント6.1**: セキュリティの確認
- [ ] 脆弱性スキャンの結果確認
- [ ] APIキー管理の安全性確認
- [ ] エラーログの適切性確認
- [ ] セキュリティ対策の効果確認

### 6.2 最終テスト
- [ ] 全機能の動作確認
- [ ] クロスブラウザテスト
- [ ] エッジケースの最終確認

**デバッグポイント6.2**: 最終テストの確認
- [ ] 全機能の動作確認結果
- [ ] クロスブラウザ互換性の確認
- [ ] エッジケースの処理確認
- [ ] テスト結果の分析

### 6.3 デプロイ準備
- [ ] 本番環境設定の準備
- [ ] バックアップ戦略の実装
- [ ] モニタリング設定の実装

**デバッグポイント6.3**: デプロイ準備の確認
- [ ] 本番環境設定の妥当性確認
- [ ] バックアップ機能の動作確認
- [ ] モニタリング機能の動作確認
- [ ] デプロイ手順の確認

## 注意事項

1. 各デバッグポイントでの動作確認を必ず行うこと
2. 要件定義書に記載されていない機能は追加しないこと
3. 技術スタックのバージョンは指定されたものを厳守すること
4. UI/UXデザインの変更は事前の承認が必要
5. 各タスクの完了時には、コードレビューを実施すること
6. デバッグポイントでの問題が解決されない場合は、次のフェーズに進まないこと 